# GachaHub タスク管理

プロジェクトの実装タスクをフェーズごとに管理します。

---

## Phase 1: 基盤構築

### データベース
- [x] データベーススキーマ設計
- [x] Productテーブル作成
- [x] ScrapeLogテーブル作成
- [x] Userテーブル作成
- [x] ScrapeConfigテーブル作成
- [ ] 必要なインデックスの追加（manufacturer, release_date, is_new）

### Spring Boot設定
- [x] application.propertiesの基本設定
- [x] PostgreSQL接続設定
- [x] Spring Data JPA設定
- [x] エンティティクラスの作成（Product, ScrapeLog, User, ScrapeConfig）
- [x] Repositoryインターフェースの作成

### React基本構成
- [x] プロジェクト構造の整理
- [x] ルーティング設定（React Router等）
- [x] API通信設定（axios等のHTTPクライアント）
- [x] 環境変数設定（.env）

### 認証機能
- [x] Spring Securityの設定
- [x] JWT認証の実装
- [x] ログインエンドポイントの作成
- [x] ログアウトエンドポイントの作成
- [x] ユーザー登録エンドポイントの作成
- [x] パスワードハッシュ化（BCrypt）
- [x] フロントエンドのログイン画面
- [x] フロントエンドのユーザー登録画面
- [x] JWTトークン管理（ローカルストレージ/Cookie）

### Docker環境整備
- [x] docker-compose.ymlにPostgreSQLサービス追加
- [x] 環境変数の設定（DATABASE_URL, JWT_SECRET等）
- [x] Docker環境での動作確認

---

## Phase 2: コア機能実装

### スクレイピング環境構築
- [x] Selenium/Playwrightの選定（Selenium採用）
- [x] 選定したツールの依存関係追加（pom.xml）
- [x] WebDriverの設定
- [x] ヘッドレスモード設定

### バンダイサイトスクレイピング
- [x] バンダイガシャポンサイトの構造調査
- [x] スクレイピングロジックの実装
- [x] パーサー実装（商品名、画像URL、発売日、価格等）
- [x] エラーハンドリング
- [ ] 単体テスト作成（モック使用）

### タカラトミーサイトスクレイピング
- [x] タカラトミーアーツサイトの構造調査
- [x] スクレイピングロジックの実装
- [x] パーサー実装
- [x] エラーハンドリング
- [ ] 単体テスト作成（モック使用）

### データ保存機能
- [x] ProductRepositoryの実装
- [x] ScrapeLogRepositoryの実装
- [x] ProductServiceの実装（CRUD操作）
- [x] ScrapeServiceの実装（スクレイピング統合処理）
- [x] 新着判定ロジック（is_newフラグ管理）
- [x] 重複チェック機能

### REST API実装
- [x] 商品一覧取得エンドポイント（GET /api/products）
- [x] 商品詳細取得エンドポイント（GET /api/products/{id}）
- [x] 商品検索・フィルタリングエンドポイント
- [x] ページネーション実装
- [x] CORS設定
- [ ] エンドポイントテスト

### フロントエンド商品一覧画面
- [ ] 商品カードコンポーネント作成
- [ ] 商品一覧画面レイアウト
- [ ] グリッド表示実装
- [ ] 新着バッジ表示
- [ ] ページネーション/無限スクロール実装
- [ ] API連携

---

## Phase 3: 自動化・通知機能

### Spring Scheduler設定
- [ ] Schedulerの有効化（@EnableScheduling）
- [ ] スケジュール実行タスクの作成
- [ ] cron式による定期実行設定
- [ ] スケジュール実行ログの記録

### スクレイピング設定機能
- [ ] ScrapeConfigの管理機能実装
- [ ] cron設定のバリデーション
- [ ] サイトごとの有効/無効切り替え
- [ ] 最終実行日時の記録

### メール通知機能
- [ ] Spring Mail依存関係追加
- [ ] Gmail SMTP設定（application.properties）
- [ ] メール送信サービスの実装
- [ ] メールテンプレート作成（HTML形式）
- [ ] 通知設定管理（ユーザーごとのON/OFF）
- [ ] テストメール送信機能

### 新着判定ロジック
- [ ] 新規商品検出アルゴリズム
- [ ] is_newフラグの自動更新
- [ ] 通知トリガー実装
- [ ] 通知送信後のフラグリセット

---

## Phase 4: 管理機能・UI改善

### 管理画面実装
- [ ] 管理画面レイアウト作成
- [ ] 認証ガード設定（未ログイン時のリダイレクト）
- [ ] ダッシュボード画面

### 手動スクレイピング実行機能
- [ ] 手動実行エンドポイント（POST /api/scrape/execute）
- [ ] サイト選択機能
- [ ] 実行ボタンUI
- [ ] 実行結果の表示
- [ ] 実行中の状態表示（ローディング）

### スクレイピング履歴表示
- [ ] 履歴取得エンドポイント（GET /api/scrape/logs）
- [ ] 履歴一覧画面
- [ ] 成功/失敗ステータス表示
- [ ] エラーメッセージ表示
- [ ] 日時フィルタリング

### サイト追加/編集機能
- [ ] サイト一覧取得エンドポイント（GET /api/scrape/configs）
- [ ] サイト追加エンドポイント（POST /api/scrape/configs）
- [ ] サイト編集エンドポイント（PUT /api/scrape/configs/{id}）
- [ ] サイト削除エンドポイント（DELETE /api/scrape/configs/{id}）
- [ ] サイト管理画面UI
- [ ] cron設定用UI（入力フォーム）

### フィルタリング・検索機能
- [ ] メーカー別フィルタリング
- [ ] 発売日順ソート
- [ ] 価格順ソート
- [ ] キーワード検索
- [ ] フィルタUIコンポーネント

### レスポンシブデザイン
- [ ] モバイル対応レイアウト
- [ ] タブレット対応レイアウト
- [ ] ブレークポイント設定
- [ ] タッチ操作対応

---

## Phase 5: 拡張・運用改善

### 追加サイト対応
- [ ] 新規サイトの調査
- [ ] スクレイピングロジック追加
- [ ] パーサー追加
- [ ] テスト追加

### パフォーマンスチューニング
- [ ] データベースクエリ最適化
- [ ] インデックスの見直し
- [ ] キャッシュ機能の検討
- [ ] スクレイピング並列処理の検討
- [ ] フロントエンドバンドルサイズ最適化

### エラーハンドリング強化
- [ ] グローバルエラーハンドラー実装
- [ ] 詳細なエラーログ記録
- [ ] エラー通知機能（管理者向け）
- [ ] リトライ機能実装
- [ ] フロントエンドエラー表示改善

### ログ監視・アラート機能
- [ ] ログ集約設定
- [ ] サイト構造変更検知アラート
- [ ] スクレイピング失敗アラート
- [ ] システムヘルスチェック
- [ ] Spring Actuatorの活用

### ユーザーフィードバック対応
- [ ] フィードバック収集機能
- [ ] 要望管理
- [ ] バグ修正対応
- [ ] 機能追加対応

---

## その他のタスク

### ドキュメント
- [ ] README.md更新
- [ ] API仕様書作成
- [ ] 環境構築手順書
- [ ] 運用マニュアル

### セキュリティ
- [ ] 脆弱性スキャン
- [ ] 依存関係の更新
- [ ] パスワードポリシー強化
- [ ] レート制限実装

### テスト
- [ ] 統合テスト作成
- [ ] E2Eテスト作成
- [ ] パフォーマンステスト
- [ ] セキュリティテスト

---

## 進捗メモ

現在のフェーズ: **Phase 2 開始** 🚀

### Phase 1完了 ✅
- Docker Compose基本設定
- Spring Boot基本プロジェクト作成
- React基本プロジェクト作成
- PostgreSQLデータベース設定
- エンティティ・リポジトリ層実装（Product, User, ScrapeLog, ScrapeConfig）
- データベースインデックス追加（idx_manufacturer, idx_release_date, idx_is_new）
- JWT認証機能の完全実装（バックエンド＋フロントエンド）
- Tailwind CSS導入とUI実装（ログイン・登録・ホーム・Aboutページ）
- 認証コンテキストとナビゲーション実装

### Phase 2進行中 🔄
**完了:**
- Selenium WebDriver 4.27.0導入
- WebDriverManager 5.9.2導入（自動ドライバー管理）
- ScraperConfig実装（Chrome WebDriver設定）
- BaseScraper実装（スクレイピング基底クラス）
- ProductService実装（CRUD操作、重複チェック、新着判定）
- ScrapeService実装（スクレイピング統合処理）
- BandaiScraper実装（gashapon.jp対応）
- TakaraTomyScraper実装（takaratomy-arts.co.jp対応）
- ScrapeController実装（手動スクレイピング実行エンドポイント）

**次のステップ:**
- フロントエンド商品一覧画面

**REST API（完了）:**
- ProductController実装（GET /api/products, /api/products/{id}, /api/products/new）
- ページネーション・ソート・フィルタリング対応
- メーカー別フィルタ、キーワード検索対応
